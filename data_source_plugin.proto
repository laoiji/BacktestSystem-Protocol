// data_source_plugin.proto
// 数据源插件的核心接口定义

syntax = "proto3";

package protocol.data_source;

import "common_types.proto"; 
import "market_data.proto";  
import "config.proto"; // <--- 关键修正：手动添加此行

// 数据查询请求结构
message DataQueryRequest {
    common.Asset asset = 1;         // 资产标识 (代码, 市场类型)
    common.TimeRange time_range = 2; // 查询时间范围
    string frequency = 3;           // K线周期 (例如: "1d", "60min", "5min")
    
    // 复权专家关键字段：请求数据源提供哪种复权因子
    enum AdjustmentType {
        ADJ_NONE = 0;               // 不复权
        ADJ_FORWARD = 1;            // 前复权
        ADJ_BACKWARD = 2;           // 后复权
    }
    AdjustmentType adjust_type = 4;
}

// 市场信息（元数据）查询请求
message MetaDataRequest {
    string market_type = 1;         // 查询哪个市场的信息 (例如: STOCK, FUTURES)
}

// 市场信息返回结构
message SecurityInfo {
    string symbol = 1;              // 证券代码
    string name = 2;                // 证券名称
    string list_date = 3;           // 上市日期 (YYYY-MM-DD)
    string delist_date = 4;         // 退市日期
}
// 数据源插件服务接口
service DataSourcePluginService {

    // 1. 连接/认证：【最终修正点】：使用绝对路径引用
    rpc Connect (.protocol.config.DataConfiguration) returns (common.Status);
    
    // 2. 获取 K 线数据：核心引擎最常调用的方法。
    // 返回一个数据流 (stream)，支持大数据量分块传输。
    rpc GetBarData (DataQueryRequest) returns (stream market.StandardBarData);

    // 3. 获取 Tick 数据：用于高频或精细化回测。
    rpc GetTickData (DataQueryRequest) returns (stream market.StandardTickData);

    // 4. 获取所有标的元数据：供 UI 界面展示和策略选择资产。
    rpc GetSecurityList (MetaDataRequest) returns (stream SecurityInfo);

    // 5. 断开连接：清理资源。
    rpc Disconnect (common.Empty) returns (common.Status);
}
